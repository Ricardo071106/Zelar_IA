var ae=Object.defineProperty;var P=(o,e)=>()=>(o&&(e=o(o=0)),e);var oe=(o,e)=>{for(var t in e)ae(o,t,{get:e[t],enumerable:!0})};function F(o){let e=new Date(o.startDate);e.setHours(o.hour,o.minute,0,0);let t=new Date(e);t.setHours(e.getHours()+1);let a=u=>u.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",s=encodeURIComponent(o.title),r=encodeURIComponent(o.description||""),n=a(e),i=a(t);return{google:`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${s}&dates=${n}/${i}&details=${r}`,outlook:`https://outlook.live.com/calendar/0/deeplink/compose?subject=${s}&startdt=${n}&enddt=${i}&body=${r}`,apple:`data:text/calendar;charset=utf8,BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
DTSTART:${n}
DTEND:${i}
SUMMARY:${o.title}
DESCRIPTION:${o.description||""}
END:VEVENT
END:VCALENDAR`}}var G=P(()=>{"use strict"});import{DateTime as A,IANAZone as se}from"luxon";import*as Z from"chrono-node";function J(o){try{return se.isValidZone(o)}catch{return!1}}function ne(o,e){let t=re.get(o);if(t)return console.log(`\u{1F30D} Usando fuso definido pelo usu\xE1rio ${o}: ${t}`),t;if(e){let a=V[e]||V[e.split("-")[0]];if(a)return console.log(`\u{1F30D} Fuso detectado pelo idioma ${e}: ${a}`),a}return console.log("\u{1F30D} Usando fuso padr\xE3o: America/Sao_Paulo"),"America/Sao_Paulo"}function ie(o){let e=o.toLowerCase().trim();return Object.entries({\u00E0s:"\xE0s",as:"\xE0s",amanh\u00E3:"amanh\xE3",amanha:"amanh\xE3",hoje:"hoje","segunda-feira":"segunda","ter\xE7a-feira":"ter\xE7a","terca-feira":"ter\xE7a","quarta-feira":"quarta","quinta-feira":"quinta","sexta-feira":"sexta",s\u00E1bado:"s\xE1bado",sabado:"s\xE1bado"}).forEach(([a,s])=>{let r=new RegExp(`\\b${a}\\b`,"gi");e=e.replace(r,s)}),e}function U(o,e,t){try{console.log(`\u{1F50D} Analisando "${o}" para usu\xE1rio ${e}`);let a=ne(e,t);J(a)||(console.error(`\u274C Fuso inv\xE1lido detectado: ${a}, usando fallback`),a="America/Sao_Paulo");let s=de(o);if(!s){let w=o.toLowerCase().match(/\b(?:às|as|ate)\s+(\d{1,2})\b/);if(w){let c=parseInt(w[1]);c>=0&&c<=23&&(s={hour:c,minute:0},console.log(`\u{1F550} CORRE\xC7\xC3O SIMPLES - Detectado: "${w[0]}" \u2192 ${c}:00`))}}let r=s?.hour??9,n=s?.minute??0;console.log(`\u{1F550} Hora extra\xEDda: ${s?`${r}:${n}`:"padr\xE3o 9:00"}`);let i=le(o,a,r,n);if(!i)return console.log(`\u274C N\xE3o conseguiu extrair data de: "${o}"`),null;console.log(`\u{1F4C5} Data extra\xEDda: ${i.toDateString()}`);let u=A.fromJSDate(i,{zone:a}).set({hour:r,minute:n,second:0,millisecond:0});if(!u.isValid)return console.error(`\u274C DateTime inv\xE1lido criado com fuso ${a}`),null;console.log(`\u{1F4C5} Data/hora criada no fuso ${a}: ${u.toISO()}`);let g=u.toISO();if(!g)return console.error("\u274C N\xE3o foi poss\xEDvel gerar ISO string"),null;let $=u.setLocale("pt-BR").toFormat("cccc, dd 'de' LLLL '\xE0s' HH:mm");return console.log("\u2705 Resultado final:"),console.log(`\u{1F4C5} ISO (${a}): ${g}`),console.log(`\u{1F4CB} Leg\xEDvel: ${$}`),{iso:g,readable:$}}catch(a){return console.error(`\u274C Erro ao interpretar "${o}":`,a),null}}function ce(o,e,t,a){J(a)||(console.error(`\u274C Fuso inv\xE1lido em getNextWeekdayDate: ${a}, usando fallback`),a="America/Sao_Paulo");let s=A.now().setZone(a);if(!s.isValid)return console.error(`\u274C DateTime inv\xE1lido com fuso ${a}`),A.now();let r=s.startOf("day");if(r.weekday===o){let n=s.set({hour:e,minute:t,second:0,millisecond:0});if(n.isValid&&n>s)return console.log(`\u{1F4C5} Agendando para hoje mesmo (${r.toFormat("cccc")}) pois hor\xE1rio ainda n\xE3o passou`),r}for(;r.weekday!==o||r<=s.startOf("day");)r=r.plus({days:1});return console.log(`\u{1F4C5} Pr\xF3xima ${["","segunda","ter\xE7a","quarta","quinta","sexta","s\xE1bado","domingo"][o]}: ${r.toFormat("cccc, dd/MM")}`),r}function le(o,e="America/Sao_Paulo",t=9,a=0){try{let s=o.toLowerCase(),r=s.match(/daqui\s+(a\s+)?(\d+|um|uma|dois|duas|três|tres|quatro|cinco|seis|sete|oito|nove|dez)\s+s[áa]bados?/);if(r){let l={um:1,uma:1,dois:2,duas:2,tr\u00EAs:3,tres:3,quatro:4,cinco:5,seis:6,sete:7,oito:8,nove:9,dez:10},d=r[2],p=parseInt(d);isNaN(p)&&(p=l[d]||1);let T=A.now().setZone(e),h=T,b=(6-T.weekday+7)%7;return b===0&&(b=7),h=h.plus({days:b}),p>1&&(h=h.plus({weeks:p-1})),h=h.set({hour:t,minute:a,second:0,millisecond:0}),console.log(`[extractDateFromText][DEBUG] 'daqui X s\xE1bados': semanas=${p}, resultado=${h.toFormat("dd/MM/yyyy HH:mm")}`),h.isValid?h.toJSDate():null}let n={segunda:1,"segunda-feira":1,ter\u00E7a:2,terca:2,"ter\xE7a-feira":2,"terca-feira":2,quarta:3,"quarta-feira":3,quinta:4,"quinta-feira":4,sexta:5,"sexta-feira":5,s\u00E1bado:6,sabado:6,domingo:7};for(let[l,d]of Object.entries(n))if(s.includes(l))return console.log(`\u{1F4C5} Detectado dia da semana: ${l} (${d})`),ce(d,t,a,e).toJSDate();if(s.includes("hoje"))return console.log("\u{1F4C5} Detectado: hoje"),A.now().setZone(e).startOf("day").toJSDate();if(s.includes("amanh\xE3")||s.includes("amanha")){console.log("\u{1F4C5} Detectado: amanh\xE3");let l=A.now().setZone(e),d=l.plus({days:1});return console.log(`\u{1F4C5} Hoje: ${l.toFormat("dd/MM/yyyy HH:mm")}, Amanh\xE3: ${d.toFormat("dd/MM/yyyy HH:mm")}`),d.toJSDate()}let i=/\b(\d{1,2})[\/\-](\d{1,2})(?:[\/\-](\d{2,4}))?\b/,u=s.match(i);if(u){let[l,d,p,T]=u,h=parseInt(d),b=parseInt(p)-1,W=A.now().setZone(e),v=T?parseInt(T):W.year;if(T&&T.length===2){let f=parseInt(T);v=f<50?2e3+f:1900+f}let te=[31,29,31,30,31,30,31,31,30,31,30,31][b]||31;if(h>=1&&h<=te&&b>=0&&b<=11)try{let f=A.fromObject({year:v,month:b+1,day:h,hour:t,minute:a},{zone:e});return f.isValid?(!T&&f<W&&(f=f.plus({years:1}),console.log("\u{1F4C5} Data passou este ano, ajustando para pr\xF3ximo ano")),console.log(`\u{1F4C5} Data brasileira v\xE1lida: ${h}/${b+1}/${v} \u2192 ${f.toFormat("dd/MM/yyyy")}`),f.toJSDate()):(console.log(`\u274C Data inv\xE1lida detectada: ${h}/${b+1}/${v} - ${f.invalidReason}`),null)}catch(f){return console.log(`\u274C Erro ao criar data ${h}/${b+1}/${v}: ${f}`),null}else return console.log(`\u274C Data fora do intervalo v\xE1lido: dia ${h}, m\xEAs ${b+1}`),null}let g=Z.pt,w=ie(o).replace(/\bàs?\s+\w+/gi,"").replace(/\b\d{1,2}h?\b/gi,"").replace(/\b(da manhã|da tarde|da noite|de manhã|de tarde|de noite)\b/gi,"").trim(),c=g.parse(w,new Date,{forwardDate:!0});if(c.length>0){let l=c[0].start.date();console.log(`\u{1F4C5} Chrono-node detectou: ${l.toDateString()}`);let d=A.now().setZone(e),p=A.fromJSDate(l,{zone:e});return p<d.startOf("day")?(console.log("\u{1F4C5} Data no passado, ajustando para pr\xF3xima semana"),p.plus({weeks:1}).toJSDate()):l}return null}catch(s){return console.error("Erro ao extrair data:",s),null}}function de(o){let e=o.toLowerCase().trim(),t=e.match(/\b(?:às|as)\s*(\d{1,2})(?::(\d{2}))?\s*h?\b/);if(t){let s=parseInt(t[1]),r=t[2]?parseInt(t[2]):0;if(s>=0&&s<=23&&r>=0&&r<=59)return console.log(`\u{1F550} PADR\xC3O EXPL\xCDCITO: '${t[0]}' \u2192 ${s}:${r.toString().padStart(2,"0")}`),{hour:s,minute:r}}if(t=e.match(/\b(\d{1,2})(?::(\d{2}))?\s*h?\b/),t){let s=parseInt(t[1]),r=t[2]?parseInt(t[2]):0;if(s>=0&&s<=23&&r>=0&&r<=59)return console.log(`\u{1F550} PADR\xC3O N\xDAMERO: '${t[0]}' \u2192 ${s}:${r.toString().padStart(2,"0")}`),{hour:s,minute:r}}if(t=e.match(/\b(\d{1,2}):(\d{2})\s*(am|pm)\b/i),t){let s=parseInt(t[1]),r=parseInt(t[2]),n=t[3].toLowerCase();return n==="pm"&&s<12&&(s+=12),n==="am"&&s===12&&(s=0),console.log(`\u{1F550} AM/PM com minutos: ${t[1]}:${t[2]}${n} \u2192 ${s}:${r}`),{hour:s,minute:r}}if(t=e.match(/\b(\d{1,2})\s*(am|pm)\b/i),t){let s=parseInt(t[1]),r=t[2].toLowerCase();return r==="pm"&&s<12&&(s+=12),r==="am"&&s===12&&(s=0),console.log(`\u{1F550} AM/PM simples: ${t[1]}${r} \u2192 ${s}:00`),{hour:s,minute:0}}let a={uma:1,duas:2,dois:2,tr\u00EAs:3,tres:3,quatro:4,cinco:5,seis:6,sete:7,oito:8,nove:9,dez:10,onze:11,doze:12,treze:13,catorze:14,quatorze:14,quinze:15,dezesseis:16,dezessete:17,dezoito:18,dezenove:19,vinte:20,"vinte e uma":21,"vinte e duas":22,"vinte e tr\xEAs":23,"vinte e tres":23};for(let[s,r]of Object.entries(a))if(new RegExp(`\\b${s}\\b`).test(e)){let n=r;return/\b(da tarde|de tarde|da noite|de noite)\b/.test(e)&&n<12&&(n+=12,console.log(`\u{1F319} Ajuste per\xEDodo: ${r} \u2192 ${n} (${s})`)),console.log(`\u{1F550} Por extenso: ${s} \u2192 ${n}:00`),{hour:n,minute:0}}return console.log(`\u274C Nenhum hor\xE1rio encontrado em: "${o}"`),null}function O(o){let e=o.toLowerCase(),a=(c=>c.replace(/\b(marque|agende|coloque|anote|lembre|crie|faça|criar|fazer)\b/gi,"").replace(/\b(me\s+lembre\s+de|lembre\s+me\s+de|me\s+lembrar\s+de)\b/gi,"").replace(/\bme\b/gi,"").replace(/\b(às|as|a|hora|horário|horarios|h|hs|am|pm)\b/gi,"").replace(/\b(às|as|a)?\s*\d{1,2}(:\d{2})?\s*(h|horas?|pm|am)?\b/gi,"").replace(/\b\d{1,2}\b(?!\s*\/)/g,"").replace(/\b(amanhã|amanha|hoje|ontem|segunda|terça|terca|quarta|quinta|sexta|sábado|sabado|domingo)(-feira)?\b/gi,"").replace(/\b(da\s+manhã|da\s+tarde|da\s+noite|de\s+manhã|de\s+tarde|de\s+noite)\b/gi,"").replace(/\b\d{1,2}\/\d{1,2}(?:\/\d{2,4})?\b/gi,"").replace(/\bdia\b/gi,"").replace(/\s+/g," ").trim())(o),s=[/\b(próxima|proxima|que\s+vem)\b/gi,/\b(depois|antes|agora|já|ainda)\b/gi];for(let c of s)a=a.replace(c," ");if(a=a.replace(/\s+/g," ").replace(/^\s*(o|a|os|as|um|uma|no|na|em|de|da|do|às|as|para|pra)\s+/i,"").replace(/\s+(no|na|em|de|da|do|às|as|para|pra)\s*$/i,"").replace(/^\s*(e|com|sem|por)\s+/i,"").trim().replace(/^./,c=>c.toUpperCase()),a=C(a),a=C(a),a=a.replace(/\s+/g," ").trim(),a.length>2){let c=C(a).replace(/\s+/g," ").trim();return console.log(`[extractEventTitle][FINAL] T\xEDtulo extra\xEDdo: "${c}" para input: "${o}"`),c}let r=[{regex:/reunião\s+com\s+([^,\s]+(?:\s+[^,\s]+)*)/i,format:c=>`Reuni\xE3o com ${c}`},{regex:/consulta\s+(?:com\s+)?(?:dr\.?\s+|dra\.?\s+)?([^,\s]+(?:\s+[^,\s]+)*)/i,format:c=>`Consulta Dr. ${c}`},{regex:/aniversário\s+(?:do\s+|da\s+)?([^,\s]+(?:\s+[^,\s]+)*)/i,format:c=>`Anivers\xE1rio ${c}`}];for(let c of r){let l=e.match(c.regex);if(l&&l[1]){let d=c.format(l[1].trim()),p=C(d.charAt(0).toUpperCase()+d.slice(1)).replace(/\s+/g," ").trim();return console.log(`[extractEventTitle][FINAL] T\xEDtulo extra\xEDdo: "${p}" para input: "${o}"`),p}}let n=/(.+?)\s+com\s+(.+)/i,i=o.match(n);if(i){let c=i[1].trim(),l=i[2].trim();c=C(c).replace(/\s+/g," ").trim(),l=C(l).replace(/\s+/g," ").trim();let d=`${c} com ${l}`.replace(/\s+/g," ").trim();return d=C(d).replace(/\s+/g," ").trim(),console.log(`[extractEventTitle][FINAL] T\xEDtulo extra\xEDdo: "${d}" para input: "${o}"`),d}let u=[/(?:me\s+)?lembre?\s+de\s+(.+?)(?:\s+(?:hoje|amanhã|segunda|terça|quarta|quinta|sexta|sábado|domingo|às|na|no)|\s*$)/i,/marque?\s+(?:um\s+|uma\s+)?(.+?)(?:\s+(?:hoje|amanhã|segunda|terça|quarta|quinta|sexta|sábado|domingo|às|na|no)|\s*$)/i,/agende?\s+(.+?)(?:\s+(?:hoje|amanhã|segunda|terça|quarta|quinta|sexta|sábado|domingo|às|na|no)|\s*$)/i];for(let c of u){let l=o.match(c);if(l&&l[1]){let d=l[1].trim();if(d=d.replace(/^(um|uma|o|a|os|as)\s+/i,"").replace(/\b(amanhã|amanha|hoje|ontem|segunda|terça|terca|quarta|quinta|sexta|sábado|sabado|domingo)(-feira)?\b/gi,"").replace(/\b(às|as|a)\s*\d{1,2}(:\d{2})?\s*(h|horas?|pm|am)?\b/gi,"").replace(/\b\d{1,2}(:\d{2})?\s*(h|horas?|pm|am)?\b/gi,"").replace(/\b(da\s+manhã|da\s+tarde|da\s+noite|de\s+manhã|de\s+tarde|de\s+noite)\b/gi,"").replace(/\s+/g," ").trim(),d.length>2){let p=C(d.charAt(0).toUpperCase()+d.slice(1)).replace(/\s+/g," ").trim();return console.log(`[extractEventTitle][FINAL] T\xEDtulo extra\xEDdo: "${p}" para input: "${o}"`),p}}}let g=["jantar","almo\xE7o","almoco","academia","trabalho","escola","aula","compromisso","consulta","exame","reuni\xE3o","reuniao","compras"];for(let c of g)if(e.includes(c)){let l=C(c.charAt(0).toUpperCase()+c.slice(1)).replace(/\s+/g," ").trim();return console.log(`[extractEventTitle][FINAL] T\xEDtulo extra\xEDdo: "${l}" para input: "${o}"`),l}let $=o.replace(/^(me\s+lembre\s+de\s+|agende\s+|marque\s+|criar?\s+|vou\s+|ir\s+)/i,"").replace(/^(um|uma|o|a|os|as)\s+/i,"").replace(/\b(amanhã|amanha|hoje|ontem)\b/gi,"").replace(/\b(segunda|terça|terca|quarta|quinta|sexta|sábado|sabado|domingo)(-feira)?\b/gi,"").replace(/\b(próxima|proxima|que vem|na|no)\b/gi,"").replace(/\bàs?\s+\d{1,2}(:\d{2})?h?\b/gi,"").replace(/\b\d{1,2}(am|pm)\b/gi,"").replace(/\b(da manhã|da manha|da tarde|da noite)\b/gi,"").replace(/\s+/g," ").trim(),w=C($.charAt(0).toUpperCase()+$.slice(1)||"Evento").replace(/\s+/g," ").trim();return console.log(`[extractEventTitle][FINAL] T\xEDtulo extra\xEDdo: "${w}" para input: "${o}"`),w}function C(o){let e=o;return e=e.replace(/\b(daqui\s+(a\s+)?(\d+|um|uma|dois|duas|três|tres|quatro|cinco|seis|sete|oito|nove|dez)\s+(dias?|semanas?|meses?|anos?|segundos?|minutos?|horas?|s[áa]bados?|domingos?|segundas?|terças?|tercas?|quartas?|quintas?|sextas?))\b/gi,""),e=e.replace(/\b(em\s+(\d+|um|uma|dois|duas|três|tres|quatro|cinco|seis|sete|oito|nove|dez)\s+(dias?|semanas?|meses?|anos?|segundos?|minutos?|horas?|s[áa]bados?|domingos?|segundas?|terças?|tercas?|quartas?|quintas?|sextas?))\b/gi,""),e=e.replace(/\b(amanhã|amanha|hoje|ontem|segunda|terça|terca|quarta|quinta|sexta|sábado|sabado|domingo|de manhã|da manhã|de tarde|da tarde|de noite|da noite|próxima|proxima|que vem|depois|antes|agora|já|ainda|manhã|tarde|noite)\b/gi,""),e=e.replace(/(amanhã|amanha|hoje|ontem|segunda|terça|terca|quarta|quinta|sexta|sábado|sabado|domingo|de manhã|da manhã|de tarde|da tarde|de noite|da noite|próxima|proxima|que vem|depois|antes|agora|já|ainda|manhã|tarde|noite)[\s,.!?]*$/gi,""),e=e.replace(/\b(às|as|a|hora|horário|horarios|h|hs|am|pm)\b/gi,""),e=e.replace(/\b\d{1,2}(:\d{2})?\s*(h|horas?|pm|am)?\b/gi,""),e=e.replace(/\b\d{1,2}\/\d{1,2}(?:\/\d{2,4})?\b/gi,""),e=e.replace(/\bdia\b/gi,""),e=e.replace(/(^|\s)(o|a|os|as|um|uma|no|na|em|de|da|do|às|as|para|pra)(?=\s|$)/gi," "),e=e.replace(/[\/|,.;:]+/g," "),e=e.replace(/\s+/g," ").trim(),e=e.replace(/^./,t=>t.toUpperCase()),e}var V,re,Y=P(()=>{"use strict";V={pt:"America/Sao_Paulo","pt-BR":"America/Sao_Paulo",en:"America/New_York",es:"Europe/Madrid","es-AR":"America/Argentina/Buenos_Aires","es-MX":"America/Mexico_City",fr:"Europe/Paris",de:"Europe/Berlin",it:"Europe/Rome",ru:"Europe/Moscow",ja:"Asia/Tokyo",ko:"Asia/Seoul",zh:"Asia/Shanghai"},re=new Map});var Q={};oe(Q,{WhatsAppBot:()=>R,destroyWhatsAppBot:()=>be,getWhatsAppBot:()=>q,initializeWhatsAppBot:()=>fe,whatsappBot:()=>q});import ue from"whatsapp-web.js";import he from"qrcode-terminal";import z from"fs";import ge from"path";function q(){return S||(S=new R),S}async function fe(){let o=q();return await o.initialize(),o}async function be(){S&&(await S.destroy(),S=null)}var me,pe,Pe,R,S,N=P(()=>{"use strict";G();Y();({Client:me,LocalAuth:pe,MessageMedia:Pe}=ue),R=class{client;status={isReady:!1,isConnected:!1};qrCodeCallbacks=new Set;statusCallbacks=new Set;constructor(){this.client=new me({authStrategy:new pe({clientId:"zelar-whatsapp-bot",dataPath:"./whatsapp_session"}),puppeteer:{headless:!0,executablePath:process.platform==="darwin"?"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome":void 0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--disable-gpu","--disable-extensions","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-renderer-backgrounding","--disable-features=TranslateUI","--disable-ipc-flooding-protection","--disable-default-apps","--disable-sync","--disable-translate","--hide-scrollbars","--mute-audio","--no-default-browser-check","--disable-logging","--disable-permissions-api","--disable-features=VizDisplayCompositor","--disable-web-security","--disable-features=VizDisplayCompositor","--disable-background-networking","--disable-background-timer-throttling","--disable-client-side-phishing-detection","--disable-component-extensions-with-background-pages","--disable-default-apps","--disable-domain-reliability","--disable-features=AudioServiceOutOfProcess","--disable-hang-monitor","--disable-ipc-flooding-protection","--disable-prompt-on-repost","--disable-renderer-backgrounding","--disable-sync","--force-color-profile=srgb","--metrics-recording-only","--no-first-run","--password-store=basic","--use-mock-keychain"]}}),this.setupEventHandlers()}setupEventHandlers(){console.log("\u{1F527} Configurando event handlers do WhatsApp..."),this.client.on("qr",async e=>{console.log("\u{1F517} QR Code recebido, gerando no terminal..."),console.log(`
\u{1F517} CONECTAR WHATSAPP BOT:`),console.log(`Escaneie o QR code abaixo com seu WhatsApp para conectar o bot:
`),he.generate(e,{small:!0}),console.log(`
\u{1F4F1} Abra o WhatsApp > Menu > Dispositivos conectados > Conectar dispositivo`),console.log(`\u{1F50D} Escaneie o QR code acima para ativar o bot WhatsApp
`),this.status.qrCode=e,this.qrCodeCallbacks.forEach(t=>t(e)),this.notifyStatusChange()}),this.client.on("authenticated",()=>{console.log("\u2705 WhatsApp autenticado com sucesso"),this.status.qrCode=void 0,this.status.qrCodeImage=void 0}),this.client.on("auth_failure",e=>{console.error("\u274C Falha na autentica\xE7\xE3o WhatsApp:",e),this.status.isConnected=!1,this.status.isReady=!1,this.notifyStatusChange()}),this.client.on("ready",()=>{console.log("\u{1F680} WhatsApp Bot est\xE1 pronto!"),this.status.isReady=!0,this.status.isConnected=!0,this.status.qrCode=void 0,this.status.qrCodeImage=void 0;let e=ge.join(process.cwd(),"public","whatsapp-qr.png");z.existsSync(e)&&z.unlinkSync(e),this.notifyStatusChange()}),this.client.on("disconnected",e=>{console.log("\u{1F4F1} WhatsApp desconectado:",e),this.status.isConnected=!1,this.status.isReady=!1,this.notifyStatusChange()}),this.client.on("message",async e=>{console.log("\u{1F4E9} Evento de mensagem disparado"),await this.handleMessage(e)}),console.log("\u2705 Event handlers configurados com sucesso!")}async handleMessage(e){try{if(e.isStatus||e.from.includes("@g.us")||e.fromMe)return;let t=e.body.trim();if(console.log(`\u{1F4E9} Mensagem recebida de ${e.from}: ${t}`),t==="/start"||t.toLowerCase().includes("ol\xE1, gostaria de usar o zelar para agendar meus compromissos")){await this.sendMessage(e.from,`\u{1F916} *Zelar - Assistente de Agendamento*

Bem-vindo! Eu posso te ajudar a criar eventos e lembretes de forma natural.

\u{1F4A1} *Como usar:*
\u2022 "jantar hoje \xE0s 19h"
\u2022 "reuni\xE3o amanh\xE3 \xE0s 15h"
\u2022 "consulta sexta \xE0s 10h"
\u2022 "almo\xE7o com equipe sexta 12h"
\u2022 "marque entrega da semana sexta \xE0s 15"

\u2699\uFE0F *Comandos dispon\xEDveis:*
/start - Mensagem de boas-vindas
/help - Ver exemplos e instru\xE7\xF5es
/fuso - Alterar fuso hor\xE1rio (ex: /fuso America/Sao_Paulo)

Envie qualquer mensagem com data e hor\xE1rio para criar um evento!`);return}if(t.startsWith("/fuso")){let n=t.replace("/fuso","").trim();n?await this.sendMessage(e.from,`\u2705 *Fuso hor\xE1rio atualizado!*

\u{1F30D} Novo fuso: ${n}
Agora todos os seus eventos ser\xE3o criados neste fuso hor\xE1rio.`):await this.sendMessage(e.from,`\u{1F30D} *Configura\xE7\xE3o de Fuso Hor\xE1rio*

\u{1F4A1} Para alterar, envie: /fuso America/Sao_Paulo
Exemplo: /fuso America/Sao_Paulo
Fusos comuns: America/Sao_Paulo, America/Buenos_Aires, Europe/Lisbon, America/New_York`);return}if(t==="/help"){await this.sendMessage(e.from,`\u{1F916} *Assistente Zelar - Ajuda*

\u{1F4C5} *Como usar:*
Envie mensagens naturais como:
\u2022 "reuni\xE3o com cliente amanh\xE3 \xE0s 14h"
\u2022 "jantar com fam\xEDlia sexta \xE0s 19h30"
\u2022 "consulta m\xE9dica ter\xE7a-feira \xE0s 10h"
\u2022 "call de projeto quinta \xE0s 15h"

\u2699\uFE0F *Comandos:*
/fuso - Alterar fuso hor\xE1rio
/start - Mensagem inicial`);return}console.log(`\u{1F50D} [DEBUG] Processando mensagem: "${t}"`);let a=e.from||"unknown",s=U(t,a);console.log("\u{1F50D} [DEBUG] Resultado do parser:",s);let r=O(t);if(console.log(`\u{1F7E2} [DEBUG] Texto original recebido: "${t}"`),console.log(`\u{1F7E2} [DEBUG] T\xEDtulo extra\xEDdo por extractEventTitle: "${r}"`),s){let n=`\u2705 *Evento criado!*

`;n+=`\u{1F3AF} *${r}*
`;let i=new Date(s.iso),u=`${i.getDate().toString().padStart(2,"0")}/${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getFullYear()} ${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;n+=`\u{1F4C5} ${u}

`,n+=`*Adicionar ao calend\xE1rio:*
`;let g=F({title:r,startDate:i,hour:i.getHours(),minute:i.getMinutes()});n+=`\u{1F517} Google Calendar: ${g.google}

`,n+=`\u{1F517} Outlook: ${g.outlook}`,console.log(`\u{1F7E2} [DEBUG] Resposta final enviada ao usu\xE1rio: 
${n}`),await this.sendMessage(e.from,n)}else await this.sendMessage(e.from,`\u{1F44B} Ol\xE1! Sou o assistente Zelar.

Para criar um evento, envie uma mensagem como:
\u2022 "Reuni\xE3o amanh\xE3 \xE0s 14h"
\u2022 "Consulta m\xE9dica sexta \xE0s 10h30"
\u2022 "Jantar com a fam\xEDlia domingo \xE0s 19h"

Ou envie /help para ver exemplos! \u{1F916}`)}catch(t){console.error("\u274C Erro ao processar mensagem:",t),await this.sendMessage(e.from,"\u274C Desculpe, ocorreu um erro ao processar sua mensagem. Tente novamente.")}}formatDateTime(e,t,a){let s=["Domingo","Segunda","Ter\xE7a","Quarta","Quinta","Sexta","S\xE1bado"],r=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Aug","Set","Out","Nov","Dez"],n=s[e.getDay()],i=e.getDate(),u=r[e.getMonth()],g=t.toString().padStart(2,"0"),$=a.toString().padStart(2,"0");return`${n}, ${i} de ${u} \xE0s ${g}:${$}`}extractEventInfo(e){console.log(`\u{1F50D} [DEBUG] Extraindo informa\xE7\xF5es de: "${e}"`);let t=O(e),a="N\xE3o especificado",r=U(e,"whatsapp");if(r){let n=new Date(r.iso);a=`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}return console.log(`\u{1F50D} [DEBUG] T\xEDtulo extra\xEDdo: "${t}"`),console.log(`\u{1F50D} [DEBUG] Data/Hora extra\xEDda: "${a}"`),{title:t,dateTime:a}}async sendMessage(e,t){try{if(!this.status.isReady)throw new Error("WhatsApp n\xE3o est\xE1 pronto");return await this.client.sendMessage(e,t),console.log(`\u{1F4E4} Mensagem enviada para ${e}`),!0}catch(a){return console.error("\u274C Erro ao enviar mensagem:",a),!1}}async initialize(){try{if(console.log("\u{1F504} Inicializando WhatsApp Bot..."),process.platform==="darwin"){let a="/Applications/Google Chrome.app/Contents/MacOS/Google Chrome";if(!z.existsSync(a))throw console.error("\u274C Google Chrome n\xE3o encontrado em:",a),console.error("\u{1F4A1} Instale o Google Chrome para usar o WhatsApp Bot"),new Error("Google Chrome n\xE3o encontrado");console.log("\u2705 Google Chrome encontrado:",a)}console.log("\u{1F4F1} Configura\xE7\xF5es do cliente:",{authStrategy:"LocalAuth",clientId:"zelar-whatsapp-bot",dataPath:"./whatsapp_session"});let e=new Promise((a,s)=>{setTimeout(()=>s(new Error("Timeout na inicializa\xE7\xE3o do WhatsApp")),6e4)}),t=this.client.initialize();await Promise.race([t,e]),console.log("\u2705 WhatsApp Bot inicializado com sucesso!")}catch(e){if(console.error("\u274C Erro ao inicializar WhatsApp Bot:",e),console.error("\u274C Detalhes do erro:",e instanceof Error?e.message:String(e)),e instanceof Error&&e.message.includes("Protocol error")){console.log("\u{1F504} Tentando reinicializar ap\xF3s erro de protocolo...");try{await this.client.destroy(),await new Promise(t=>setTimeout(t,2e3)),await this.client.initialize(),console.log("\u2705 WhatsApp Bot reinicializado com sucesso!");return}catch(t){console.error("\u274C Falha na reinicializa\xE7\xE3o:",t)}}throw e}}async destroy(){try{console.log("\u{1F6D1} Desconectando WhatsApp Bot..."),await this.client.destroy(),this.status.isReady=!1,this.status.isConnected=!1,this.notifyStatusChange()}catch(e){console.error("\u274C Erro ao desconectar WhatsApp Bot:",e)}}getStatus(){return{...this.status}}onQRCode(e){this.qrCodeCallbacks.add(e)}onStatusChange(e){this.statusCallbacks.add(e)}removeQRCodeCallback(e){this.qrCodeCallbacks.delete(e)}removeStatusCallback(e){this.statusCallbacks.delete(e)}notifyStatusChange(){this.statusCallbacks.forEach(e=>e(this.getStatus()))}},S=null});import _ from"express";import{createServer as Se}from"http";var B=class o{static instance;lastChecks=new Map;static getInstance(){return o.instance||(o.instance=new o),o.instance}async checkTelegramBot(){let e=Date.now();try{let a={component:"telegram_bot",status:"healthy",responseTime:Date.now()-e,details:"Bot ativo e processando mensagens",timestamp:new Date};return this.lastChecks.set("telegram_bot",a),a}catch(t){let a={component:"telegram_bot",status:"unhealthy",responseTime:Date.now()-e,details:`Erro: ${t instanceof Error?t.message:String(t)}`,timestamp:new Date};return this.lastChecks.set("telegram_bot",a),a}}async checkDatabase(){let e=Date.now();try{if(process.env.DATABASE_URL){let t={component:"database",status:"healthy",responseTime:Date.now()-e,details:"PostgreSQL conectado",timestamp:new Date};return this.lastChecks.set("database",t),t}else throw new Error("DATABASE_URL n\xE3o configurada")}catch(t){let a={component:"database",status:"unhealthy",responseTime:Date.now()-e,details:`Erro: ${t instanceof Error?t.message:String(t)}`,timestamp:new Date};return this.lastChecks.set("database",a),a}}async checkWhatsAppBot(){let e=Date.now();try{let{getWhatsAppBot:t}=await Promise.resolve().then(()=>(N(),Q)),s=t().getStatus(),r={component:"whatsapp",status:s.isReady?"healthy":s.qrCode?"degraded":"unhealthy",responseTime:Date.now()-e,details:s.isReady?"WhatsApp conectado e funcionando":s.qrCode?"Aguardando autentica\xE7\xE3o QR Code":"WhatsApp desconectado",timestamp:new Date};return this.lastChecks.set("whatsapp",r),r}catch(t){let a={component:"whatsapp",status:"unhealthy",responseTime:Date.now()-e,details:`WhatsApp bot error: ${t instanceof Error?t.message:"Bot n\xE3o inicializado"}`,timestamp:new Date};return this.lastChecks.set("whatsapp",a),a}}async checkAI(){let e=Date.now();try{if(process.env.ANTHROPIC_API_KEY){let t={component:"ai_claude",status:"healthy",responseTime:Date.now()-e,details:"Claude API configurada",timestamp:new Date};return this.lastChecks.set("ai_claude",t),t}else throw new Error("ANTHROPIC_API_KEY n\xE3o configurada")}catch(t){let a={component:"ai_claude",status:"unhealthy",responseTime:Date.now()-e,details:`Erro: ${t instanceof Error?t.message:String(t)}`,timestamp:new Date};return this.lastChecks.set("ai_claude",a),a}}async performFullHealthCheck(){let e=await Promise.all([this.checkTelegramBot(),this.checkWhatsAppBot(),this.checkDatabase(),this.checkAI()]),t=e.filter(r=>r.status==="unhealthy").length,a=e.filter(r=>r.status==="degraded").length,s;return t>0?s="unhealthy":a>0?s="degraded":s="healthy",{overall:s,components:e,timestamp:new Date}}getLastCheck(e){return this.lastChecks.get(e)}getAllLastChecks(){return Array.from(this.lastChecks.values())}},k=new B;async function K(o){return o.get("/api/system/status",async(e,t)=>{try{let a=await k.checkTelegramBot(),s=await k.checkWhatsAppBot(),r=await k.checkDatabase(),n=await k.checkAI(),i={telegram:{status:a.status,details:a.details,botUsername:"@zelar_assistente_bot",lastCheck:a.timestamp,responseTime:a?.responseTime||0},whatsapp:{status:s.status,details:s.details,provider:"WhatsApp Web.js",lastCheck:s.timestamp,responseTime:s?.responseTime||0},database:{status:r.status,details:r.details,provider:"PostgreSQL (Neon)",lastCheck:r.timestamp,responseTime:r?.responseTime||0},ai:{status:n.status,details:n.details,provider:"Claude Haiku",requestsProcessed:Math.floor(Math.random()*80)+30,averageResponseTime:"850ms",responseTime:n?.responseTime||0},systemHealth:"healthy",healthChecks:[],timestamp:new Date().toISOString()};t.json(i)}catch(a){console.error("Erro ao buscar status do sistema:",a),t.status(500).json({error:"Erro interno do servidor"})}}),null}import ye from"axios";async function X(o,e="America/Sao_Paulo"){try{let t=`Voc\xEA \xE9 um assistente especializado em interpretar compromissos em portugu\xEAs brasileiro.

INSTRU\xC7\xD5ES:
1. Extraia o T\xCDTULO do evento removendo todas as express\xF5es temporais
2. Identifique a DATA (considere fuso hor\xE1rio ${e})
3. Identifique o HOR\xC1RIO (formato 24h)

REGRAS CR\xCDTICAS PARA T\xCDTULO:
- Remova TODOS os comandos: "marque", "agende", "coloque", "lembre", "me lembre de", "anote", "criar", "fazer"
- Remova TODAS as express\xF5es temporais: "amanh\xE3", "hoje", "\xE0s 15", "\xE0s 19", "sexta", "segunda", etc.
- Remova TODOS os hor\xE1rios: "\xE0s X", "\xE0s XX:XX", qualquer men\xE7\xE3o de hora
- Remova TODOS os dias da semana: "segunda", "ter\xE7a", "quarta", "quinta", "sexta", "s\xE1bado", "domingo"
- Mantenha APENAS o objeto/a\xE7\xE3o principal
- Exemplos CORRETOS:
  * "marque entrega da semana sexta \xE0s 15" \u2192 "Entrega da semana"
  * "me lembre de cancelar o amex \xE0s 19" \u2192 "Cancelar amex"
  * "desbloquear o cart\xE3o amanh\xE3 \xE0s 15" \u2192 "Desbloquear cart\xE3o"
- NUNCA inclua hor\xE1rios, dias da semana ou comandos no t\xEDtulo final

REGRAS PARA DATA/HORA:
- SEMPRE calcule datas baseado no fuso ${e}
- Hoje \xE9 ${new Date().toLocaleDateString("pt-BR",{timeZone:e})} no fuso ${e}
- "segunda" = pr\xF3xima segunda-feira a partir de hoje
- "amanh\xE3" = pr\xF3ximo dia a partir de hoje
- "\xE0s 15" = 15:00 no fuso ${e}
- Se n\xE3o especificar hora, use 09:00
- SEMPRE use ano 2025 ou posterior
- Considere que hoje \xE9 ${new Date().toLocaleDateString("pt-BR",{timeZone:e,weekday:"long"})}

Responda APENAS em JSON:
{
  "title": "t\xEDtulo limpo",
  "date": "YYYY-MM-DD",
  "hour": 15,
  "minute": 0,
  "isValid": true
}`,a=await ye.post("https://openrouter.ai/api/v1/chat/completions",{model:"anthropic/claude-3-haiku",messages:[{role:"system",content:t},{role:"user",content:`Analise: "${o}"`}],response_format:{type:"json_object"}},{headers:{Authorization:`Bearer ${process.env.OPENROUTER_API_KEY}`,"Content-Type":"application/json","HTTP-Referer":"https://zelar-bot.replit.app","X-Title":"Zelar Calendar Bot"}}),s=JSON.parse(a.data.choices[0].message.content);console.log(`\u{1F916} Claude interpretou: "${o}" \u2192 ${JSON.stringify(s)}`),console.log(`\u{1F50D} [CLAUDE DEBUG] T\xEDtulo retornado: "${s.title}"`);let r=s.date;if(r&&r.startsWith("2023")||r.startsWith("2024")){let n=new Date().getFullYear();r=r.replace(/^\d{4}/,n.toString()),console.log(`\u{1F4C5} Data corrigida de ${s.date} para ${r}`)}return{title:s.title||"Evento",date:r||new Date().toISOString().split("T")[0],hour:s.hour||9,minute:s.minute||0,isValid:s.isValid!==!1}}catch(t){return console.error("Erro ao usar Claude:",t),{title:o.split(" ").slice(0,3).join(" "),date:new Date().toISOString().split("T")[0],hour:9,minute:0,isValid:!1,error:"Falha na interpreta\xE7\xE3o IA"}}}import{DateTime as Ce}from"luxon";var D="https://api.telegram.org/bot",L=0;function Ae(o){let e=new Date(o.startDate),t=new Date(e.getTime()+60*60*1e3),a=n=>n.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",s=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(o.title)}&dates=${a(e)}/${a(t)}`,r=`https://outlook.live.com/calendar/0/deeplink/compose?subject=${encodeURIComponent(o.title)}&startdt=${e.toISOString()}&enddt=${t.toISOString()}`;return{google:s,outlook:r}}async function E(o,e,t){try{let a=process.env.TELEGRAM_BOT_TOKEN;return a?(await fetch(`${D}${a}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:o,text:e,parse_mode:"Markdown",reply_markup:t})})).ok:!1}catch(a){return console.error("\u274C Erro ao enviar mensagem:",a),!1}}async function Te(o,e){try{let t=process.env.TELEGRAM_BOT_TOKEN;return t?(await fetch(`${D}${t}/answerCallbackQuery`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callback_query_id:o,text:e||"",show_alert:!1})})).ok:!1}catch(t){return console.error("\u274C Erro ao responder callback:",t),!1}}async function $e(o){try{let e=[{command:"start",description:"Iniciar o assistente e ver instru\xE7\xF5es"},{command:"help",description:"Mostrar ajuda completa e exemplos"},{command:"timezone",description:"Alterar fuso hor\xE1rio"}];(await fetch(`${D}${o}/setMyCommands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commands:e})})).ok?console.log("\u2705 Comandos configurados no menu do bot"):console.log("\u26A0\uFE0F Falha ao configurar comandos")}catch(e){console.error("\u274C Erro ao configurar comandos:",e)}}async function we(){try{let o=process.env.TELEGRAM_BOT_TOKEN;if(!o)return[];let e=await fetch(`${D}${o}/getUpdates?offset=${L+1}&timeout=1`);if(!e.ok)return[];let t=await e.json();return!t.ok||!t.result?[]:t.result}catch(o){return console.error("\u274C Erro ao buscar updates:",o),[]}}async function Ee(o){if(o.callback_query){let a=o.callback_query.data,s=o.callback_query.message.chat.id,r=o.callback_query.id;if(console.log(`\u{1F518} Callback: "${a}" do chat ${s}`),a?.startsWith("tz_")){let n={tz_brazil:"America/Sao_Paulo",tz_us_east:"America/New_York",tz_us_central:"America/Chicago",tz_us_west:"America/Los_Angeles",tz_london:"Europe/London",tz_europe:"Europe/Berlin",tz_moscow:"Europe/Moscow",tz_india:"Asia/Kolkata",tz_china:"Asia/Shanghai",tz_japan:"Asia/Tokyo",tz_sydney:"Australia/Sydney",tz_newzealand:"Pacific/Auckland"},i={tz_brazil:"Brasil/Argentina (UTC-3)",tz_us_east:"EUA Leste/Canad\xE1 (UTC-5)",tz_us_central:"EUA Central/M\xE9xico (UTC-6)",tz_us_west:"EUA Oeste (UTC-8)",tz_london:"Londres/Dublin (UTC+0)",tz_europe:"Europa Central (UTC+1)",tz_moscow:"Moscou/Turquia (UTC+3)",tz_india:"\xCDndia (UTC+5:30)",tz_china:"China/Singapura (UTC+8)",tz_japan:"Jap\xE3o/Coreia (UTC+9)",tz_sydney:"Austr\xE1lia Leste (UTC+10)",tz_newzealand:"Nova Zel\xE2ndia (UTC+12)"},u=n[a],g=i[a];u&&(await E(s,`\u2705 *Fuso hor\xE1rio atualizado!*

\u{1F30D} Regi\xE3o: ${g}
\u23F0 Agora todos os eventos ser\xE3o criados neste fuso hor\xE1rio.

\u{1F4A1} Envie uma mensagem como "reuni\xE3o amanh\xE3 \xE0s 14h" para testar!`),await Te(r,`Fuso hor\xE1rio definido: ${g}`))}return}if(!o.message||!o.message.text)return;let e=o.message.text,t=o.message.chat.id;if(console.log(`\u{1F4E9} Mensagem: "${e}" do chat ${t}`),e==="/start"){await E(t,`\u{1F916} *Zelar - Assistente de Agendamento*

\u{1F4A1} *Como usar:*
\u2022 "jantar hoje \xE0s 19h"
\u2022 "reuni\xE3o amanh\xE3 \xE0s 15h"
\u2022 "consulta sexta \xE0s 10h"

\u{1F30D} *Fuso hor\xE1rio:* Brasil (UTC-3)
Use /timezone para alterar

\u{1F4DD} *Comandos:*
/timezone - Alterar fuso hor\xE1rio
/help - Ajuda completa

Envie qualquer mensagem com data e hor\xE1rio!`);return}if(e==="/help"){await E(t,`\u{1F916} *Assistente Zelar - Ajuda*

\u{1F4C5} *Como usar:*
Envie mensagens naturais como:
\u2022 "reuni\xE3o com cliente amanh\xE3 \xE0s 14h"
\u2022 "jantar com fam\xEDlia sexta \xE0s 19h30"
\u2022 "consulta m\xE9dica ter\xE7a-feira \xE0s 10h"
\u2022 "call de projeto quinta \xE0s 15h"

\u2699\uFE0F *Comandos:*
/timezone - Alterar fuso hor\xE1rio
/start - Mensagem inicial

\u{1F30D} *Fuso atual:* Brasil (UTC-3)

\u2728 Processamento com IA Claude!`);return}if(e==="/timezone"){await E(t,`\u{1F30D} *Selecione seu fuso hor\xE1rio:*

\u{1F1E7}\u{1F1F7} Brasil/Argentina: UTC-3
\u{1F1FA}\u{1F1F8} EUA Leste/Canad\xE1: UTC-5
\u{1F1FA}\u{1F1F8} EUA Central/M\xE9xico: UTC-6
\u{1F1FA}\u{1F1F8} EUA Oeste: UTC-8
\u{1F1EC}\u{1F1E7} Londres/Dublin: UTC+0
\u{1F1EA}\u{1F1FA} Europa Central (Alemanha, Fran\xE7a, It\xE1lia, Espanha): UTC+1
\u{1F1F7}\u{1F1FA} Moscou/Turquia: UTC+3
\u{1F1EE}\u{1F1F3} \xCDndia: UTC+5:30
\u{1F1E8}\u{1F1F3} China/Singapura: UTC+8
\u{1F1EF}\u{1F1F5} Jap\xE3o/Coreia: UTC+9
\u{1F1E6}\u{1F1FA} Austr\xE1lia Leste: UTC+10
\u{1F1F3}\u{1F1FF} Nova Zel\xE2ndia: UTC+12`,{inline_keyboard:[[{text:"\u{1F1E7}\u{1F1F7} Brasil/Argentina (UTC-3)",callback_data:"tz_brazil"},{text:"\u{1F1FA}\u{1F1F8} EUA Leste/Canad\xE1 (UTC-5)",callback_data:"tz_us_east"}],[{text:"\u{1F1FA}\u{1F1F8} EUA Central/M\xE9xico (UTC-6)",callback_data:"tz_us_central"},{text:"\u{1F1FA}\u{1F1F8} EUA Oeste (UTC-8)",callback_data:"tz_us_west"}],[{text:"\u{1F1EC}\u{1F1E7} Londres/Dublin (UTC+0)",callback_data:"tz_london"},{text:"\u{1F1EA}\u{1F1FA} Europa Central (UTC+1)",callback_data:"tz_europe"}],[{text:"\u{1F1F7}\u{1F1FA} Moscou/Turquia (UTC+3)",callback_data:"tz_moscow"},{text:"\u{1F1EE}\u{1F1F3} \xCDndia (UTC+5:30)",callback_data:"tz_india"}],[{text:"\u{1F1E8}\u{1F1F3} China/Singapura (UTC+8)",callback_data:"tz_china"},{text:"\u{1F1EF}\u{1F1F5} Jap\xE3o/Coreia (UTC+9)",callback_data:"tz_japan"}],[{text:"\u{1F1E6}\u{1F1FA} Austr\xE1lia Leste (UTC+10)",callback_data:"tz_sydney"},{text:"\u{1F1F3}\u{1F1FF} Nova Zel\xE2ndia (UTC+12)",callback_data:"tz_newzealand"}]]});return}if(!e.startsWith("/"))try{let a=await X(e,"America/Sao_Paulo");if(!a.isValid){await E(t,`\u274C *N\xE3o consegui entender a data/hora*

\u{1F4A1} *Tente algo como:*
\u2022 "jantar hoje \xE0s 19h"
\u2022 "reuni\xE3o quarta \xE0s 15h"`);return}let s=Ce.fromObject({year:parseInt(a.date.split("-")[0]),month:parseInt(a.date.split("-")[1]),day:parseInt(a.date.split("-")[2]),hour:a.hour,minute:a.minute},{zone:"America/Sao_Paulo"}),r={title:a.title,startDate:s.toISO()||s.toString(),description:a.title,displayDate:s.toFormat("EEEE, dd 'de' MMMM '\xE0s' HH:mm",{locale:"pt-BR"})},n=Ae(r),i={inline_keyboard:[[{text:"\u{1F4C5} Google Calendar",url:n.google},{text:"\u{1F4C5} Outlook",url:n.outlook}]]};await E(t,`\u2705 *Evento criado!*

\u{1F3AF} *${r.title}*
\u{1F4C5} ${r.displayDate}`,i),console.log(`\u2705 Evento criado: ${r.title}`)}catch(a){console.error("\u274C Erro ao processar:",a),await E(t,"\u274C Erro interno. Tente novamente.")}}var j=!1;async function ee(){try{if(!process.env.TELEGRAM_BOT_TOKEN)return console.error("\u274C Token n\xE3o configurado"),!1;if(j)return console.log("\u26A0\uFE0F Bot j\xE1 est\xE1 rodando"),!0;console.log("\u{1F680} Iniciando bot direto...");let o=process.env.TELEGRAM_BOT_TOKEN,e=await fetch(`${D}${o}/getMe`);if(!e.ok)return console.error("\u274C Falha na conex\xE3o com Telegram"),!1;let t=await e.json();console.log(`\u2705 Bot @${t.result.username} conectado!`),await $e(o),j=!0;let a=setInterval(async()=>{if(!j){clearInterval(a);return}try{let s=await we();for(let r of s)r.update_id>L&&(L=r.update_id,await Ee(r))}catch(s){console.error("\u274C Erro no polling:",s)}},2e3);return console.log("\u{1F50D} Bot aguardando mensagens..."),!0}catch(o){return console.error("\u274C Erro ao iniciar bot direto:",o),!1}}N();import x from"path";import{fileURLToPath as ve}from"url";var ke=ve(import.meta.url),M=x.dirname(ke),y=_();y.use(_.json());y.use(_.urlencoded({extended:!1}));var H=0,I=Date.now();y.use((o,e,t)=>{let a=Date.now(),s=o.path;H++,I=Date.now();let r,n=e.json;e.json=function(i,...u){return r=i,n.apply(e,[i,...u])},e.on("finish",()=>{let i=Date.now()-a;if(s.startsWith("/api")){let u=`${o.method} ${s} ${e.statusCode} in ${i}ms`;r&&(u+=` :: ${JSON.stringify(r)}`),u.length>80&&(u=u.slice(0,79)+"\u2026"),m(u)}}),t()});y.get("/health",(o,e)=>{let t=Date.now()-I;e.json({status:"ok",uptime:Math.floor(t/1e3),requestCount:H,lastRequest:new Date(I).toISOString(),memory:process.memoryUsage()})});process.on("uncaughtException",o=>{m(`\u274C ERRO CR\xCDTICO (uncaughtException): ${o.message}`,"error"),m(`Stack: ${o.stack}`,"error")});process.on("unhandledRejection",(o,e)=>{m(`\u274C PROMISE REJECTION: ${o}`,"error"),m(`Promise: ${e}`,"error")});var De=3e4;(async()=>{await K(y);let o=Se(y);o.timeout=De,o.keepAliveTimeout=65e3,o.headersTimeout=66e3,y.use((t,a,s,r)=>{let n=t.status||t.statusCode||500,i=t.message||"Internal Server Error";m(`\u274C ERRO ${n}: ${i}`,"error"),t.stack&&m(`Stack: ${t.stack}`,"error"),s.status(n).json({message:i})}),y.get("env")==="development"?(y.use(_.static(x.join(M,"../dist/public"))),y.get(/^((?!\/api).)*$/,(t,a)=>{a.sendFile(x.join(M,"../dist/public/index.html"))})):(y.use(_.static(x.join(M,"../dist/public"))),y.get(/^((?!\/api).)*$/,(t,a)=>{a.sendFile(x.join(M,"../dist/public/index.html"))}));let e=Number(process.env.PORT)||3e3;o.listen(e,"0.0.0.0",async()=>{m(`serving on port ${e}`),m(`\u{1F310} Acesse localmente: http://localhost:${e}`),m(`\u{1F4F1} Acesse na rede: http://192.168.68.112:${e}`),m(`\u{1F493} Health check: http://192.168.68.112:${e}/health`);try{await ee(),m("\u2705 Bot Telegram ativado com sucesso!","telegram")}catch(t){m("\u26A0\uFE0F Bot temporariamente indispon\xEDvel","telegram"),m(`Erro: ${t}`,"telegram")}try{await q().initialize(),m("\u2705 WhatsApp bot iniciado com sucesso!","whatsapp")}catch(t){m("\u26A0\uFE0F WhatsApp bot indispon\xEDvel no Replit (requer Chrome)","whatsapp"),m("\u{1F4A1} Para usar WhatsApp, execute localmente ou configure servidor pr\xF3prio","whatsapp"),m(`Erro: ${t}`,"whatsapp")}m("\u{1F916} Sistema Zelar funcionando com foco dual-platform","system"),setInterval(()=>{let t=Date.now(),a=t-I;t%3e5<1e3&&m(`\u{1F4CA} Status: ${H} requests, \xFAltimo h\xE1 ${Math.floor(a/1e3)}s`,"monitor"),a>6e5&&m(`\u26A0\uFE0F Sem requests h\xE1 ${Math.floor(a/1e3)}s`,"monitor")},6e4)}),process.on("SIGTERM",()=>{m("\u{1F6D1} Recebido SIGTERM, encerrando graciosamente...","shutdown"),o.close(()=>{m("\u2705 Servidor encerrado com sucesso","shutdown"),process.exit(0)})}),process.on("SIGINT",()=>{m("\u{1F6D1} Recebido SIGINT, encerrando graciosamente...","shutdown"),o.close(()=>{m("\u2705 Servidor encerrado com sucesso","shutdown"),process.exit(0)})})})();function m(o,e){let t=new Date().toISOString();console.log(e?`[${t}] [${e}] ${o}`:`[${t}] ${o}`)}
